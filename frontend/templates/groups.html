<div class="sidebar">
  <div class="view-toggle">
    <button
      class="toggle-btn"
      hx-get="/api/users"
      hx-target=".sidebar"
      hx-trigger="click"
      onclick="setActiveView(this, 'users')"
    >
      Users
    </button>
    <button
      class="toggle-btn active"
      hx-get="/api/groups"
      hx-target=".sidebar"
      hx-trigger="click"
      onclick="setActiveView(this, 'groups')"
    >
      Groups
    </button>
  </div>

  <h3>Groups</h3>
  <input type="text" placeholder="Search groups..." id="groupSearch" />
  <ul>
    {% for group in groups %}
    <li
      class="user-item"
      onclick="displayGroupMembers(this, '{{ group.displayName }}', {{ group.members | tojson }})"
    >
      <div class="user-info">
        <span class="user-name">{{ group.displayName }}</span>
        <span class="user-email">Members: {{ group.memberCount }}</span>
      </div>
    </li>
    {% endfor %}
  </ul>
</div>

<script>
  function displayGroupMembers(element, groupName, members) {
    document.querySelectorAll(".user-item").forEach((el) => {
      el.classList.remove("active");
    });
    element.classList.add("active");

    logOutput(`Selected group: ${groupName}`);

    const memberList = members
      .map(
        (member) =>
          `${member.displayName} (${member.userPrincipalName || "No email"})`
      )
      .join("\n");

    logOutput(`Group Members (${members.length}):\n${memberList}`);
  }

  function logOutput(message) {
    const output = document.getElementById("output-log");
    const timestamp = new Date().toLocaleTimeString();
    output.innerHTML += `\n[${timestamp}] ${message}`;
    output.scrollTop = output.scrollHeight;
  }

  function setActiveView(element, view) {
    document.querySelectorAll(".toggle-btn").forEach((btn) => {
      btn.classList.remove("active");
    });
    element.classList.add("active");
    logOutput(`Switching to ${view} view...`);
  }
</script>
